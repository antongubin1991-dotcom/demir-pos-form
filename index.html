<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-key="title">Demir POS Form</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico" />

  <link rel="stylesheet" href="style.css" />

  <!-- Leaflet (карты) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- html2pdf для PDF (сейчас не используется, можно убрать при желании) -->
  <script defer src="translations.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body class="light">
  <div class="app">

    <!-- HEADER -->
    <header class="app-header">
      <div class="brand">
        <img src="logo.png" class="brand-logo" alt="Demir">
        <div>
          <div class="brand-title">Demir POS</div>
          <div class="brand-subtitle">Форма установки POS-терминала</div>
        </div>
      </div>

      <div class="header-controls">
        <select id="themeToggle" class="field-input">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>

        <select id="langSelect" class="field-input">
          <option value="ru">RU</option>
          <option value="kg">KG</option>
          <option value="en">EN</option>
        </select>
      </div>
    </header>

    <!-- MAIN -->
    <main class="app-main">
      <div class="card">

        <!-- ==========================
             БЛОК 1 — Тип заявки
        ============================== -->
        <section class="section">
          <h2 class="section-title" data-key="sec_request">Тип заявки и договор</h2>
          <div class="grid two">
            <label class="field">
              <span class="field-label">Номер договора</span>
              <input name="contractNumber" type="text" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Дата договора</span>
              <input name="contractDate" type="date" class="field-input" />
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Номер заявки (c/n)</span>
              <input name="applicationNumber" type="text" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Дата заявки</span>
              <input name="applicationDate" type="date" class="field-input" />
            </label>
          </div>

          <div class="grid two">
            <fieldset class="field">
              <legend class="field-label">Тип заявки</legend>
              <div class="chips">
                <label class="chip"><input type="checkbox" name="requestType" value="new" /> Новый терминал(ы)</label>
                <label class="chip"><input type="checkbox" name="requestType" value="replace" /> Замена терминала</label>
                <label class="chip"><input type="checkbox" name="requestType" value="updateData" /> Смена данных</label>
                <label class="chip"><input type="checkbox" name="requestType" value="qr" /> QR / QR Landing</label>
              </div>
            </fieldset>
            <fieldset class="field">
              <legend class="field-label">POS-терминал</legend>
              <div class="chips">
                <label class="chip"><input type="checkbox" name="terminalType" value="withKKM" /> С ККМ</label>
                <label class="chip"><input type="checkbox" name="terminalType" value="withoutKKM" /> Без ККМ</label>
              </div>
            </fieldset>
          </div>
        </section>
                  <div class="grid two">
            <label class="field">
              <span class="field-label">Статус клиента</span>
              <select id="clientStatus" class="field-input">
                <option value="">— выбрать —</option>
                <option value="existing">Действующий клиент</option>
                <option value="new">Новый клиент</option>
              </select>
            </label>
          </div>

        <!-- 1. КОМПАНИЯ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_company">Данные компании</h2>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Наименование компании / ТСП</span>
              <input id="companyName" class="field-input" type="text">
            </label>

            <label class="field">
              <span class="field-label">ИНН / БИН</span>
              <input id="companyBin" class="field-input" type="text" maxlength="14">
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Руководитель</span>
              <input id="companyHead" class="field-input" type="text">
            </label>

            <label class="field">
              <span class="field-label">ИНН руководителя</span>
              <input id="companyHeadInn" class="field-input" type="text" maxlength="14">
            </label>
          </div>
        </section>

        <!-- 2. КОНТАКТЫ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_contacts">Контакты</h2>
          <div class="grid two">
            <label class="field">
              <span class="field-label">Email клиента</span>
              <input id="email" name="email" type="email" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Ответственное лицо</span>
              <input id="manager" name="contactPerson" type="text" class="field-input" />
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Телефон (городской)</span>
              <input id="phone" name="phone" type="tel" class="field-input" placeholder="+996..." />
            </label>
            <label class="field">
              <span class="field-label">Телефон мобильный</span>
              <input id="mobilePhone" name="mobilePhone" type="tel" class="field-input" placeholder="+996..." />
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Время работы (с)</span>
              <input name="workFrom" type="time" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Время работы (до)</span>
              <input name="workTo" type="time" class="field-input" />
            </label>
          </div>
        </section>

        <!-- ==========================
             БЛОК 2 — Типы карточек
        ============================== -->
        <section class="section">
          <h2 class="section-title" data-key="sec_cards">Типы карточек</h2>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="cardTypes" value="Visa" /> Visa</label>
            <label class="chip"><input type="checkbox" name="cardTypes" value="MasterCard" /> MasterCard</label>
            <label class="chip"><input type="checkbox" name="cardTypes" value="Elkart" /> Элкарт</label>
          </div>
        </section>

        <!-- 3. POS + КОМИССИИ + СКИДКИ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_pos">POS-терминал и условия</h2>

          <!-- Модель POS -->
          <label class="field">
            <span class="field-label">Модель POS / тип решения</span>
            <select id="posModel" class="field-input">
              <option value="">— выбрать —</option>
              <option value="Beko">BEKO</option>
              <option value="SoftPOS">SoftPOS</option>
              <option value="Ingenico">Ingenico</option>
              <option value="aishino">Aishino A90</option>
              <option value="Kozen">Kozen</option>
            </select>
          </label>

          <hr class="divider">

          <!-- ==========================
               БЛОК 6 — Банковские реквизиты
          ============================== -->
          <section class="section">
            <h2 class="section-title" data-key="sec_bank">Банковские реквизиты</h2>

            <div class="grid two">
              <label class="field">
                <span class="field-label">Номер счета в ДКИБ</span>
                <input name="accountNumber" type="text" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Ответственный филиал ДКИБ</span>
                <select id="responsibleBranches" class="field-input"></select>
              </label>
            </div>
          </section>

          <!-- Комиссии -->
          <h3 class="section-title">Комиссии</h3>

          <div class="table-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th>Вид карты</th>
                  <th>Комиссия, %</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Карты VISA, выпущенные ДКИБ</td>
                  <td><input id="comm_visa_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Размер бонуса</td>
                  <td><input id="comm_bonus_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты VISA, выпущенные другими банками</td>
                  <td><input id="comm_visa_other" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты Элкарт, выпущенные ДКИБ</td>
                  <td><input id="comm_elcart_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты Элкарт, выпущенные другими банками</td>
                  <td><input id="comm_elcart_other" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты MasterCard, выпущенные ДКИБ</td>
                  <td><input id="comm_mc_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты MasterCard, выпущенные другими банками</td>
                  <td><input id="comm_mc_other" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <hr class="divider">

          <!-- Скидки -->
          <h3 class="section-title">Скидки</h3>

          <div class="table-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th>Описание</th>
                  <th>%</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Скидка на 10 карт</td>
                  <td><input id="discount_10" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- 4. РАЙОН → УГНС -->
        <section class="section">
          <h2 class="section-title">Район и УГНС</h2>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Район</span>
              <select id="district" class="field-input">
                <option value="">— выбрать район —</option>
              </select>
            </label>

            <label class="field">
              <span class="field-label">Код УГНС</span>
              <input id="ugnsCode" class="field-input" type="text" readonly>
            </label>
          </div>
        </section>

        <!-- 5. ВИД ДЕЯТЕЛЬНОСТИ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_business">Вид деятельности</h2>

          <label class="field">
            <span class="field-label" data-key="lbl_business_object">Тип объекта предпринимательства</span>
            <select id="businessObjectType" class="field-input">
              <!-- Заполняется в script.js -->
            </select>
          </label>

          <label class="field">
            <span class="field-label" data-key="lbl_activity_type">Вид деятельности</span>
            <select id="activityType" class="field-input">
              <!-- Заполняется в script.js -->
            </select>
          </label>
        </section>

        <!-- 6. АДРЕСА (ЮР. И ТОРГОВЫЙ) -->
        <section class="section">
          <h2 class="section-title" data-key="sec_address_legal">Юридический адрес</h2>

          <label class="field">
            <span class="field-label" data-key="legal_address">Юридический адрес</span>
            <input id="legalAddress" class="field-input" data-placeholder="legal_address">
          </label>

          <div id="legalMap" class="map-box no-translate"></div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Широта</span>
              <input id="legalLat" class="field-input" placeholder="Lat">
            </label>
            <label class="field">
              <span class="field-label">Долгота</span>
              <input id="legalLon" class="field-input" placeholder="Lon">
            </label>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title" data-key="sec_address_trade">Адрес торговой точки</h2>

          <label class="field">
            <span class="field-label" data-key="trade_address">Адрес торговой точки</span>
            <input id="tradeAddress" class="field-input" data-placeholder="trade_address">
          </label>

          <div id="tradeMap" class="map-box no-translate"></div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Широта</span>
              <input id="tradeLat" class="field-input" placeholder="Lat">
            </label>
            <label class="field">
              <span class="field-label">Долгота</span>
              <input id="tradeLon" class="field-input" placeholder="Lon">
            </label>
          </div>
        </section>

        <!-- ==========================
             БЛОК 10 — Подписи (canvas)
        ============================== -->
        <section class="section">
          <h2 class="section-title">Подпись заявителя</h2>

          <div class="signature-box">
            <canvas id="signaturePad"></canvas>
          </div>
        
          <div class="signature-actions">
            <button type="button" id="signatureClear" class="btn secondary">
              Очистить подпись
            </button>
          </div>

          <!-- base64 подпись для JSON / SLK -->
          <input type="hidden" id="signatureData" name="signatureData" />
        </section>

        <!-- 7. КОММЕНТАРИЙ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_comment">Комментарий</h2>

          <!-- Логин/пароль от lk.salyk.kg (в одной строке) -->
          <div class="grid two">
            <label class="field">
              <span class="field-label">Логин от lk.salyk.kg (e-mail)</span>
              <input id="lkLogin" class="field-input" type="email" />
            </label>

            <label class="field">
              <span class="field-label">Пароль от lk.salyk.kg</span>
              <input id="lkPassword" class="field-input" type="text" />
            </label>
          </div>

          <!-- Комментарий -->
          <label class="field">
            <span class="field-label" data-key="description">Комментарий</span>
            <textarea id="description" class="field-input" rows="3"></textarea>
          </label>
        </section>
        
       <!-- КНОПКИ ДЕЙСТВИЙ -->
<section class="section">
  <div class="actions-row">
    <button id="savePdf" class="btn">Сохранить PDF</button>
    <button id="clearForm" type="button" class="btn secondary">
      Очистить форму
    </button>
  </div>
</section>
      </div> <!-- .card -->
    </main> <!-- .app-main -->

    <!-- ============================================================
         ОФИЦИАЛЬНЫЙ PDF-ДОКУМЕНТ (СКРЫТЫЙ)
    ============================================================ -->
    <div id="pdfDocument"
     style="
       display:none;
       font-family:'Times New Roman',serif;
       font-size:10pt;
       line-height:1.15;
       padding:10px 20px;
       background:#ffffff;
       color:#000000;
       width:800px;
     ">

  <!-- ВЕРХ -->
  <div style="margin-bottom:8px; font-size:9pt;">
    <div>Новый терминал(ы) __________________ Приложение № 1</div>
    <div>Замена POS-терминала(ов) __________________</div>
    <div style="padding-left:12px;">
      к Договору № __________ от «____» ______ 20____ г.
    </div>
    <div>Смена данных ___________________________</div>
    <div>QR / QR Landing ________________________</div>
    <div>POS с ККМ ______________________________</div>
    <div>POS без ККМ _____________________________</div>
  </div>

  <!-- Заголовок заявки -->
  <div style="text-align:center; font-weight:bold; font-size:12pt; margin-bottom:4px;">
    Заявка на регистрацию пункта обслуживания c/n __________________
  </div>

  <div style="text-align:right; margin-bottom:8px; font-size:9pt;">
    <span id="pdf_date">«____» _________ 20____ г.</span> г. Бишкек
  </div>

  <!-- Просьба -->
  <p style="text-indent:20px; margin:0 0 8px 0; font-size:9pt;">
    Просим Вас зарегистрировать пункт обслуживания в Процессинговом центре и обеспечить расходными материалами в количестве согласно данной заявке.
  </p>

  <!-- Типы карт -->
  <p style="margin:4px 0 10px 0; font-size:9pt;">
    Типы карточек: Visa • MasterCard • Элкарт • МИР (нужное выделить)
  </p>

  <!-- Данные торговой точки -->
  <h3 style="margin:6px 0 4px 0; font-size:10.5pt;">Данные торговой точки</h3>

  <table style="width:100%; border-collapse:collapse; margin-bottom:8px;">
    <tr>
      <td style="width:40%; font-weight:bold;">Наименование:</td>
      <td id="pdf_companyName" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">ИНН/БИН:</td>
      <td id="pdf_companyBin" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">Руководитель:</td>
      <td id="pdf_companyHead" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">Сотр. привлекший клиента:</td>
      <td id="pdf_manager" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">Телефон:</td>
      <td id="pdf_phone" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">E-mail:</td>
      <td id="pdf_email" style="border-bottom:1px solid #000;"></td>
    </tr>
  </table>

  <!-- Адреса -->
  <h3 style="margin:4px 0 4px 0; font-size:10.5pt;">Адреса</h3>

  <table style="width:100%; border-collapse:collapse; margin-bottom:8px;">
    <tr>
      <td style="width:40%; font-weight:bold;">Юридический адрес:</td>
      <td id="pdf_legalAddress" style="border-bottom:1px solid #000;"></td>
    </tr>
    <tr>
      <td style="font-weight:bold;">Адрес торговой точки:</td>
      <td id="pdf_tradeAddress" style="border-bottom:1px solid #000;"></td>
    </tr>
    <tr>
      <td style="font-weight:bold;">Район / УГНС:</td>
      <td id="pdf_district_ugns" style="border-bottom:1px solid #000;"></td>
    </tr>
  </table>

  <!-- Деятельность -->
  <h3 style="margin:4px 0 4px 0; font-size:10.5pt;">Вид деятельности</h3>

  <table style="width:100%; border-collapse:collapse; margin-bottom:8px;">
    <tr>
      <td style="width:40%; font-weight:bold;">Тип объекта:</td>
      <td id="pdf_businessObjectType" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">Вид деятельности:</td>
      <td id="pdf_activityType" style="border-bottom:1px solid #000;"></td>
    </tr>

    <tr>
      <td style="font-weight:bold;">Модель POS:</td>
      <td id="pdf_posModel" style="border-bottom:1px solid #000;"></td>
    </tr>
  </table>

  <!-- Комиссии -->
  <h3 style="margin:4px 0 4px 0; font-size:10.5pt;">Комиссии</h3>

  <table style="width:100%; border-collapse:collapse; margin-bottom:8px; font-size:9pt;">
    <tr>
      <td style="width:60%;">VISA ДКИБ</td>
      <td id="pdf_comm_visa_dkb" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
    <tr>
      <td>Бонус</td>
      <td id="pdf_comm_bonus_dkb" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
    <tr>
      <td>VISA другие</td>
      <td id="pdf_comm_visa_other" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
    <tr>
      <td>Элкарт ДКИБ</td>
      <td id="pdf_comm_elcart_dkb" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
    <tr>
      <td>Элкарт другие</td>
      <td id="pdf_comm_elcart_other" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
    <tr>
      <td>MasterCard ДКИБ</td>
      <td id="pdf_comm_mc_dkb" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
    <tr>
      <td>MasterCard другие</td>
      <td id="pdf_comm_mc_other" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
  </table>

  <!-- Скидки -->
  <h3 style="margin:4px 0 4px 0; font-size:10.5pt;">Скидки</h3>

  <table style="width:100%; border-collapse:collapse; margin-bottom:8px; font-size:9pt;">
    <tr>
      <td style="width:60%;">Скидка на 10 карт</td>
      <td id="pdf_discount_10" style="border-bottom:1px solid #000; text-align:center;"></td>
    </tr>
  </table>

  <!-- LK -->
  <h3 style="margin:4px 0 4px 0; font-size:10.5pt;">Логин/пароль от lk.salyk.kg</h3>

  <table style="width:100%; border-collapse:collapse; margin-bottom:8px;">
    <tr>
      <td style="width:40%; font-weight:bold;">Логин:</td>
      <td id="pdf_lkLogin" style="border-bottom:1px solid #000;"></td>
    </tr>
    <tr>
      <td style="font-weight:bold;">Пароль:</td>
      <td id="pdf_lkPassword" style="border-bottom:1px solid #000;"></td>
    </tr>
  </table>

  <!-- Комментарий -->
  <h3 style="margin:4px 0 4px 0; font-size:10.5pt;">Комментарий</h3>

  <div id="pdf_description"
       style="min-height:25px; border-bottom:1px solid #000; margin-bottom:10px;"></div>

  <!-- Подпись клиента -->
  <div style="margin-bottom:6px; font-size:10pt;">
    Подпись клиента:
    <div>
      <img id="pdf_signature" style="max-height:45px; margin-top:2px;" />
    </div>
  </div>

  <!-- Подписи -->
  <table style="width:100%; margin-top:6px; font-size:9pt;">
    <tr>
      <td style="width:50%; text-align:center;">
        _________ / _________<br/>Руководитель
      </td>
      <td style="width:50%; text-align:center;">
        _________ / _________<br/>Сотрудник Банка
      </td>
    </tr>
  </table>

</div>
</body>
</html>
