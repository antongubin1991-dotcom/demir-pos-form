<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-key="title">Demir POS Form</title>

  <link rel="stylesheet" href="style.css" />

  <!-- Leaflet (карты) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- html2pdf для PDF (сейчас не используется, можно убрать при желании) -->
  <script defer src="translations.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script defer src="script.js"></script>
</head>
<body class="light">
  <div class="app">

    <!-- HEADER -->
    <header class="app-header">
      <div class="brand">
        <img src="logo.png" class="brand-logo" alt="Demir">
        <div>
          <div class="brand-title">Demir POS</div>
          <div class="brand-subtitle">Форма установки POS-терминала</div>
        </div>
      </div>

      <div class="header-controls">
        <select id="themeToggle" class="field-input">
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>

        <select id="langSelect" class="field-input">
          <option value="ru">RU</option>
          <option value="kg">KG</option>
          <option value="en">EN</option>
        </select>
      </div>
    </header>

    <!-- MAIN -->
    <main class="app-main">
      <div class="card">

        <!-- ==========================
             БЛОК 1 — Тип заявки
        ============================== -->
        <section class="section">
          <h2 class="section-title">Тип заявки и договор</h2>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Номер договора</span>
              <input name="contractNumber" type="text" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Дата договора</span>
              <input name="contractDate" type="date" class="field-input" />
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Номер заявки (c/n)</span>
              <input name="applicationNumber" type="text" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Дата заявки</span>
              <input name="applicationDate" type="date" class="field-input" />
            </label>
          </div>

          <div class="grid two">
            <fieldset class="field">
              <legend class="field-label">Тип заявки</legend>
              <div class="chips">
                <label class="chip"><input type="checkbox" name="requestType" value="new" /> Новый терминал(ы)</label>
                <label class="chip"><input type="checkbox" name="requestType" value="replace" /> Замена терминала</label>
                <label class="chip"><input type="checkbox" name="requestType" value="updateData" /> Смена данных</label>
                <label class="chip"><input type="checkbox" name="requestType" value="qr" /> QR / QR Landing</label>
              </div>
            </fieldset>
            <fieldset class="field">
              <legend class="field-label">POS-терминал</legend>
              <div class="chips">
                <label class="chip"><input type="checkbox" name="terminalType" value="withKKM" /> С ККМ</label>
                <label class="chip"><input type="checkbox" name="terminalType" value="withoutKKM" /> Без ККМ</label>
              </div>
            </fieldset>
          </div>
        </section>
                  <div class="grid two">
            <label class="field">
              <span class="field-label">Статус клиента</span>
              <select id="clientStatus" class="field-input">
                <option value="">— выбрать —</option>
                <option value="existing">Действующий клиент</option>
                <option value="new">Новый клиент</option>
              </select>
            </label>
          </div>

        <!-- 1. КОМПАНИЯ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_company">Данные компании</h2>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Наименование компании / ТСП</span>
              <input id="companyName" class="field-input" type="text">
            </label>

            <label class="field">
              <span class="field-label">ИНН / БИН</span>
              <input id="companyBin" class="field-input" type="text" maxlength="14">
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Руководитель</span>
              <input id="companyHead" class="field-input" type="text">
            </label>

            <label class="field">
              <span class="field-label">ИНН руководителя</span>
              <input id="companyHeadInn" class="field-input" type="text" maxlength="14">
            </label>
          </div>
        </section>

        <!-- 2. КОНТАКТЫ -->
        <section class="section">
          <h2 class="section-title">Контакты</h2>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Email клиента</span>
              <input id="email" name="email" type="email" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Ответственное лицо</span>
              <input id="manager" name="contactPerson" type="text" class="field-input" />
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Телефон (городской)</span>
              <input id="phone" name="phone" type="tel" class="field-input" placeholder="+996..." />
            </label>
            <label class="field">
              <span class="field-label">Телефон мобильный</span>
              <input id="mobilePhone" name="mobilePhone" type="tel" class="field-input" placeholder="+996..." />
            </label>
          </div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Время работы (с)</span>
              <input name="workFrom" type="time" class="field-input" />
            </label>
            <label class="field">
              <span class="field-label">Время работы (до)</span>
              <input name="workTo" type="time" class="field-input" />
            </label>
          </div>
        </section>

        <!-- ==========================
             БЛОК 2 — Типы карточек
        ============================== -->
        <section class="section">
          <h2 class="section-title">Типы карточек</h2>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="cardTypes" value="Visa" /> Visa</label>
            <label class="chip"><input type="checkbox" name="cardTypes" value="MasterCard" /> MasterCard</label>
            <label class="chip"><input type="checkbox" name="cardTypes" value="Elkart" /> Элкарт</label>
          </div>
        </section>

        <!-- 3. POS + КОМИССИИ + СКИДКИ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_pos">POS-терминал и условия</h2>

          <!-- Модель POS -->
          <label class="field">
            <span class="field-label">Модель POS / тип решения</span>
            <select id="posModel" class="field-input">
              <option value="">— выбрать —</option>
              <option value="Beko">BEKO</option>
              <option value="SoftPOS">SoftPOS</option>
              <option value="Ingenico">Ingenico</option>
              <option value="aishino">Aishino A90</option>
              <option value="Kozen">Kozen</option>
            </select>
          </label>

          <hr class="divider">

          <!-- ==========================
               БЛОК 6 — Банковские реквизиты
          ============================== -->
          <section class="section">
            <h2 class="section-title">Банковские реквизиты</h2>

            <div class="grid two">
              <label class="field">
                <span class="field-label">Номер счета в ДКИБ</span>
                <input name="accountNumber" type="text" class="field-input" />
              </label>
              <label class="field">
                <span class="field-label">Ответственный филиал ДКИБ</span>
                <select id="responsibleBranches" class="field-input"></select>
              </label>
            </div>
          </section>

          <!-- Комиссии -->
          <h3 class="section-title">Комиссии</h3>

          <div class="table-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th>Вид карты</th>
                  <th>Комиссия, %</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Карты VISA, выпущенные ДКИБ</td>
                  <td><input id="comm_visa_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Размер бонуса</td>
                  <td><input id="comm_bonus_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты VISA, выпущенные другими банками</td>
                  <td><input id="comm_visa_other" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты Элкарт, выпущенные ДКИБ</td>
                  <td><input id="comm_elcart_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты Элкарт, выпущенные другими банками</td>
                  <td><input id="comm_elcart_other" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты MasterCard, выпущенные ДКИБ</td>
                  <td><input id="comm_mc_dkb" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
                <tr>
                  <td>Карты MasterCard, выпущенные другими банками</td>
                  <td><input id="comm_mc_other" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <hr class="divider">

          <!-- Скидки -->
          <h3 class="section-title">Скидки</h3>

          <div class="table-wrap">
            <table class="tbl">
              <thead>
                <tr>
                  <th>Описание</th>
                  <th>%</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Скидка на 10 карт</td>
                  <td><input id="discount_10" class="field-input" type="number" step="0.01" placeholder="%"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- 4. РАЙОН → УГНС -->
        <section class="section">
          <h2 class="section-title">Район и УГНС</h2>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Район</span>
              <select id="district" class="field-input">
                <option value="">— выбрать район —</option>
              </select>
            </label>

            <label class="field">
              <span class="field-label">Код УГНС</span>
              <input id="ugnsCode" class="field-input" type="text" readonly>
            </label>
          </div>
        </section>

        <!-- 5. ВИД ДЕЯТЕЛЬНОСТИ -->
        <section class="section">
          <h2 class="section-title" data-key="sec_business">Вид деятельности</h2>

          <label class="field">
            <span class="field-label" data-key="lbl_business_object">Тип объекта предпринимательства</span>
            <select id="businessObjectType" class="field-input">
              <!-- Заполняется в script.js -->
            </select>
          </label>

          <label class="field">
            <span class="field-label" data-key="lbl_activity_type">Вид деятельности</span>
            <select id="activityType" class="field-input">
              <!-- Заполняется в script.js -->
            </select>
          </label>
        </section>

        <!-- 6. АДРЕСА (ЮР. И ТОРГОВЫЙ) -->
        <section class="section">
          <h2 class="section-title" data-key="sec_address_legal">Юридический адрес</h2>

          <label class="field">
            <span class="field-label" data-key="legal_address">Юридический адрес</span>
            <input id="legalAddress" class="field-input" data-placeholder="legal_address">
          </label>

          <div id="legalMap" class="map-box no-translate"></div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Широта</span>
              <input id="legalLat" class="field-input" placeholder="Lat">
            </label>
            <label class="field">
              <span class="field-label">Долгота</span>
              <input id="legalLon" class="field-input" placeholder="Lon">
            </label>
          </div>
        </section>

        <section class="section">
          <h2 class="section-title" data-key="sec_address_trade">Адрес торговой точки</h2>

          <label class="field">
            <span class="field-label" data-key="trade_address">Адрес торговой точки</span>
            <input id="tradeAddress" class="field-input" data-placeholder="trade_address">
          </label>

          <div id="tradeMap" class="map-box no-translate"></div>

          <div class="grid two">
            <label class="field">
              <span class="field-label">Широта</span>
              <input id="tradeLat" class="field-input" placeholder="Lat">
            </label>
            <label class="field">
              <span class="field-label">Долгота</span>
              <input id="tradeLon" class="field-input" placeholder="Lon">
            </label>
          </div>
        </section>

        <!-- ==========================
             БЛОК 10 — Подписи (canvas)
        ============================== -->
        <section class="section">
          <h2 class="section-title">Подпись заявителя</h2>

          <div class="signature-box">
            <canvas id="signaturePad"></canvas>
          </div>
        
          <div class="signature-actions">
            <button type="button" id="signatureClear" class="btn secondary">
              Очистить подпись
            </button>
          </div>

          <!-- base64 подпись для JSON / SLK -->
          <input type="hidden" id="signatureData" name="signatureData" />
        </section>

        <!-- 7. КОММЕНТАРИЙ -->
        <section class="section">
          <h2 class="section-title">Комментарий</h2>

          <!-- Логин/пароль от lk.salyk.kg (в одной строке) -->
          <div class="grid two">
            <label class="field">
              <span class="field-label">Логин от lk.salyk.kg (e-mail)</span>
              <input id="lkLogin" class="field-input" type="email" />
            </label>

            <label class="field">
              <span class="field-label">Пароль от lk.salyk.kg</span>
              <input id="lkPassword" class="field-input" type="text" />
            </label>
          </div>

          <!-- Комментарий -->
          <label class="field">
            <span class="field-label" data-key="description">Комментарий</span>
            <textarea id="description" class="field-input" rows="3"></textarea>
          </label>
        </section>
        
       <!-- КНОПКИ ДЕЙСТВИЙ -->
<section class="section">
  <div class="actions-row">
    <button id="savePdf" class="btn">Сохранить PDF</button>
    <button id="clearForm" type="button" class="btn secondary">
      Очистить форму
    </button>
  </div>
</section>
      </div> <!-- .card -->
    </main> <!-- .app-main -->

    <!-- ============================================================
         ОФИЦИАЛЬНЫЙ PDF-ДОКУМЕНТ (СКРЫТЫЙ)
    ============================================================ -->
    <div id="pdfDocument"
         style="
           display:none;
           font-family:'Times New Roman',serif;
           font-size:12pt;
           line-height:1.3;
           padding:20px;
           background:#ffffff;
           color:#000000;
           width:800px;
           min-height:1100px;
         ">

      <!-- ВЕРХНИЙ БЛОК: ВИД ЗАЯВКИ -->
      <div style="margin-bottom:16px; font-size:11pt;">
        <div>Новый терминал(ы) ________________________ Приложение № 1</div>
        <div>
          Замена POS-терминала(ов) (поломка или сервис) ________________________
        </div>
        <div style="padding-left:16px;">
          к Договору № __________________ от «____» ______________ 20____ г.
        </div>
        <div>Смена данных (адрес, тел. и т.д.) ________________________________</div>
        <div>QR / QR Landing _________________________________________________</div>
        <div>POS терминал с ККМ ______________________________________________</div>
        <div>POS терминал без ККМ ____________________________________________</div>
      </div>

      <!-- ЗАГОЛОВОК ЗАЯВКИ + ДАТА / ГОРОД -->
      <div style="text-align:center; font-weight:bold; font-size:14pt; margin-bottom:8px;">
        Заявка на регистрацию пункта обслуживания c/n __________________
      </div>

      <div style="text-align:right; margin-bottom:16px; font-size:11pt;">
        <span id="pdf_date">«____» __________ 20____ г.</span>&nbsp;&nbsp;&nbsp; г. Бишкек
      </div>

      <!-- ТЕКСТ-ПРОСЬБА -->
      <p style="text-indent:20px; margin:0 0 16px 0; font-size:11pt;">
        Просим Вас зарегистрировать пункт обслуживания в Процессинговом центре и обеспечить расходными
        материалами в количестве согласно данной заявке.
      </p>

      <!-- ТИПЫ КАРТОЧЕК (просто строкой, как в оригинале) -->
      <p style="margin:8px 0 16px 0; font-size:11pt;">
        Типы карточек:&nbsp;&nbsp; Visa &nbsp;&nbsp; MasterCard &nbsp;&nbsp; Элкарт &nbsp;&nbsp; МИР
        &nbsp;&nbsp; (нужное выделить)
      </p>

      <!-- БЛОК КОМПАНИИ -->
      <h3 style="margin:12px 0 6px 0; font-size:12pt;">Данные торговой точки</h3>
      <table style="width:100%; border-collapse:collapse; margin-bottom:12px; font-size:11pt;">
        <tr>
          <td style="width:260px; font-weight:bold;">Наименование торговой точки:</td>
          <td id="pdf_companyName" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">ИНН/БИН:</td>
          <td id="pdf_companyBin" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Руководитель:</td>
          <td id="pdf_companyHead" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Сотрудник, привлекший клиента:</td>
          <td id="pdf_manager" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Контактный телефон:</td>
          <td id="pdf_phone" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">E-mail:</td>
          <td id="pdf_email" style="border-bottom:1px solid #000;"></td>
        </tr>
      </table>

      <!-- АДРЕСА -->
      <h3 style="margin:10px 0 6px 0; font-size:12pt;">Адреса</h3>
      <table style="width:100%; border-collapse:collapse; margin-bottom:12px; font-size:11pt;">
        <tr>
          <td style="width:220px; font-weight:bold;">Юридический адрес:</td>
          <td id="pdf_legalAddress" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Адрес торговой точки:</td>
          <td id="pdf_tradeAddress" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Район / УГНС:</td>
          <td id="pdf_district_ugns" style="border-bottom:1px solid #000;"></td>
        </tr>
      </table>

      <!-- ВИД ДЕЯТЕЛЬНОСТИ -->
      <h3 style="margin:10px 0 6px 0; font-size:12pt;">Вид деятельности</h3>
      <table style="width:100%; border-collapse:collapse; margin-bottom:12px; font-size:11pt;">
        <tr>
          <td style="width:280px; font-weight:bold;">Тип объекта предпринимательства:</td>
          <td id="pdf_businessObjectType" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Вид деятельности:</td>
          <td id="pdf_activityType" style="border-bottom:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="font-weight:bold;">Модель POS-терминала:</td>
          <td id="pdf_posModel" style="border-bottom:1px solid #000;"></td>
        </tr>
      </table>

      <!-- КОМИССИИ -->
      <h3 style="margin:12px 0 6px 0; font-size:12pt;">Комиссии</h3>
      <table style="width:100%; border-collapse:collapse; margin-bottom:16px; font-size:11pt;">
        <tr>
          <th style="border:1px solid #000; padding:6px; text-align:left;">Вид карты</th>
          <th style="border:1px solid #000; padding:6px; text-align:center;">Комиссия, %</th>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Карты VISA, выпущенные ДКИБ</td>
          <td id="pdf_comm_visa_dkb" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Размер бонуса</td>
          <td id="pdf_comm_bonus_dkb" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Карты VISA, выпущенные другими банками</td>
          <td id="pdf_comm_visa_other" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Карты Элкарт, выпущенные ДКИБ</td>
          <td id="pdf_comm_elcart_dkb" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Карты Элкарт, выпущенные другими банками</td>
          <td id="pdf_comm_elcart_other" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Карты MasterCard, выпущенные ДКИБ</td>
          <td id="pdf_comm_mc_dkb" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Карты MasterCard, выпущенные другими банками</td>
          <td id="pdf_comm_mc_other" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
      </table>

      <!-- СКИДКИ -->
      <h3 style="margin:12px 0 6px 0; font-size:12pt;">Скидки</h3>
      <table style="width:100%; border-collapse:collapse; margin-bottom:20px; font-size:11pt;">
        <tr>
          <th style="border:1px solid #000; padding:6px; text-align:left;">Описание</th>
          <th style="border:1px solid #000; padding:6px; text-align:center;">%</th>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">Скидка на 10 карт</td>
          <td id="pdf_discount_10" style="border:1px solid #000; padding:6px; text-align:center;"></td>
        </tr>
      </table>

      <!-- ЛОГИН/ПАРОЛЬ ОТ LK.SALYK.KG -->
      <h3 style="margin:12px 0 6px 0; font-size:12pt;">Логин/пароль от lk.salyk.kg</h3>
      <div style="display:flex; gap:16px; margin-bottom:12px;">
        <div style="flex:1;">
          <div style="font-size:10pt; margin-bottom:2px;">Логин (e-mail)</div>
          <div id="pdf_lkLogin"
               style="min-height:24px; border-bottom:1px solid #000;"></div>
        </div>
        <div style="flex:1;">
          <div style="font-size:10pt; margin-bottom:2px;">Пароль</div>
          <div id="pdf_lkPassword"
               style="min-height:24px; border-bottom:1px solid #000;"></div>
        </div>
      </div>

      <!-- КОММЕНТАРИЙ -->
      <h3 style="margin:12px 0 6px 0; font-size:12pt;">Комментарий</h3>
      <div id="pdf_description"
           style="min-height:40px; border-bottom:1px solid #000; margin-bottom:24px;"></div>

      <!-- ПОДПИСЬ КЛИЕНТА -->
      <div class="pdf-signature-block">
        <div>Подпись клиента:</div>
        <div class="pdf-signature-line">
          <img id="pdf_signature" style="max-height:60px; margin-top:4px;" />
        </div>
      </div>

      <!-- ПОДПИСИ РУКОВОДИТЕЛЯ И СОТРУДНИКА БАНКА -->
      <table style="width:100%; margin-top:20px; font-size:11pt;">
        <tr>
          <td style="width:50%; text-align:center;">
            ____________________ / ____________________<br/>
            Подпись руководителя / ФИО
          </td>
          <td style="width:50%; text-align:center;">
            ____________________ / ____________________<br/>
            Сотрудник Банка
          </td>
        </tr>
      </table>
    </div> <!-- #pdfDocument -->

  </div> <!-- .app -->
</body>
</html>
